<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            /* reset */
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .button {
            margin: 8px;
            padding: 8px;
            border: 2px solid;
            cursor: pointer;
            box-shadow: 3px 3px 0 gray;
            transition: .1s all;
        }
        label.button {
            display: inline-block;
            background-color: buttonface;
            font-family: Arial, serif;
            font-size: 13.33333px;
        }
        .button:hover {
            box-shadow: 0 0 1000px gray;
        }
        input[type=file] {
            display: none;
        }
        button.menu-icon-close {
            position: absolute;
            top: 8px;
            right: 8px;
        }
        .hide {
            display: none;
        }
        .title {
            text-align: center;
        }
        .calendar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .calendar > div {
            width: calc((100% - (10px * 2) * 5) / 7); /* 100% / gap 10px from 2 sides for 5 items in middle */
            flex: 1 1 auto;
            height: 200px;
            white-space: nowrap;
        }
        .month-cell {
            position: relative;
            border: 2px solid black;
            background-color: white;
        }
        .month-cell img {
            object-fit: cover;
            width: 100%;
            height: 200px; /* related to .calendar > div { */
            margin-right: 5px;
        }
        .month-cell .m-year {
            position: absolute;
            top: 0;
            left: 0;
            background-color: white;
        }
        .month-cell .m-day,
        .m-no-photo-space .m-day {
            position: absolute;
            bottom: 0;
            right: 0;
            z-index: 2;
            color: white;
            font-size: 72px;
            font-weight: bold;
            mix-blend-mode: difference;
        }
        .m-white-space {
            border: 2px solid white;
            overflow: hidden;
        }
        .m-no-photo-space {
            position: relative;
            border: 2px solid black;
            overflow: hidden;
            background-color: white;
        }
        .amount-photos {
            padding: 3px;
            width: 20px;
            height: 20px;
            text-align: center;
            position: absolute;
            bottom: 0;
            left: 0;
            z-index: 2;
            background-color: lightskyblue;
            border-radius: 100%;
        }
        @media print {
            .amount-photos { display: none; }
        }

        /* MENU */
        .menu {
            padding: 8px;
            position: absolute;
            top: 0;
            z-index: 9;
            width: 50%;
            height: 100%;
            transition: .3s all;
            transform: translateX(calc(-100% - 3px)); /* box-shadow */
            background-color: white;
            box-shadow: 3px 0 0 gray;
        }
        .menu.open {
            transform: translateX(0);
        }
        .menu .button {
            margin: 0;
        }

        .preview-image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px 0;
        }

        .previewImage {
            width: 100px;
            height: 100px;
        }

        textarea {
            display: block;
            width: 100%;
            height: 200px;
        }

        /* Switcher */
        .switch {
            position: relative;
            display: inline-block;
            width: 88px;
            height: 34px;
            box-shadow: 3px 3px 0 gray;
        }

        .switch:hover {
            box-shadow: 0 0 100px gray;
        }

        .switch .switch input {
            display:none;
        }

        .switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: gray;
            transition: .3s linear;
        }

        .switch .slider:before {
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            height: 26px;
            width: 54px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
        }
        .switch .slider:before {
            content: attr(data-link);
        }

        .switch input:checked + .slider {
            background-color: black;
        }

        .switch input:focus + .slider {
            box-shadow: 3px 3px 0 lightskyblue;
        }

        .switch input:checked + .slider:before {
            transform: translateX(24px);
            content: attr(data-upload);
        }

        .loaded-sources,
        .loaded-sources .button {
            margin-top: 8px;
        }

        .linked-sources,
        .linked-sources .button {
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <button class="button menu-icon-main"
            onClick="toggleMenu()">menu</button>
    <div id="menu"
         class="menu">
        <label>
            <input type="text" id="calendar-month">
        </label>
        <div style="font-family: Arial, serif; line-height: 34px;">The file sources would be provided as:
            <label id="switch"
                   class="switch">
                <input type="checkbox">
                <span class="slider"
                      data-link="link"
                      data-upload="upload"></span>
            </label>
        </div>
        <div class="loaded-sources hide">
            <label class="button">
                upload files
                <input type="file"
                       multiple
                       id="files">
            </label>
            <div id="preview-image-container"
                 class="preview-image-container"></div>
            <button class="button"
                    onclick="render()">render</button>
        </div>
        <div class="linked-sources">
            <textarea placeholder="For example, for Windows users -> C:/Users/user_name/Pictures/2000-03-01 14:03:11.jpg"></textarea>
            <button class="button"
                    onclick="render2()">render</button>
        </div>
        <small>find "/Volumes/MyPassport/#Photo_cloud/2021/2021.03" -type f -regex '.*[0-9]\{2\}\/[0-9]\{4\}-.*' > listOfFiles.list</small>
        <button class="button menu-icon-close"
                onClick="toggleMenu()">X</button>
    </div>
    <div id="title"
         class="title"></div>
    <div id="calendar"
         class="calendar">
    </div>
<script>
    const testData = [
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 00.12.11.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.28.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.29.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.37.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.38.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.42.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.52.43.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.53.02.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.53.04.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.53.06.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.53.12-1.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 15.53.12.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 18.40.43.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 18.41.00.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.20/2021-03-20 18.41.02.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.03/2021-03-03 19.17.18.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.03/2021-03-03 19.17.25.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.09/2021-03-09 22.46.26.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.09/2021-03-09 22.46.36.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.09/2021-03-09 22.46.55.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.09/2021-03-09 22.47.06.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.09/2021-03-09 23.25.49.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.12/2021-03-12 22.06.30.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.12/2021-03-12 22.06.39.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.12/2021-03-12 22.06.41.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.15/2021-03-15 17.59.13.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 16.12.01.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 17.47.28.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 19.58.15.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 19.58.42.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 19.58.59.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 19.59.16.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 19.59.43.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 20.00.01.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 20.00.28.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 20.00.43.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 20.01.21.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 21.12.02.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.18/2021-03-18 21.12.30.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.19/2021-03-19 01.30.52.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.19/2021-03-19 17.11.42.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.19/2021-03-19 17.15.23.dng',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.21/2021-03-21 14.18.36.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.21/2021-03-21 17.20.14.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.21/2021-03-21 17.20.16.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.21/2021-03-21 17.20.17.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.21/2021-03-21 17.20.18.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.27/2021-03-27 12.02.40.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.27/2021-03-27 12.02.46.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.27/2021-03-27 12.30.22.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.27/2021-03-27 15.57.16.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.27/2021-03-28 10.59.17.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.29/2021-03-29 20.44.08.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.29/2021-03-29 20.44.15.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.29/2021-03-29 20.44.23.jpg',
        '/Volumes/MyPassport/%23Photo_cloud/2021/2021.03/2021.03.01/2021-03-01 19.50.44.jpg',
    ];
    document.querySelector('textarea').value = testData.toString();

    document.querySelector('#files').addEventListener('change', fileUploads);
    document.querySelector('#switch').addEventListener('change', toggleSources);

    let isFilesReady = false;
    let files = [];
    let arrangedData = {};
    let filePromises = [];

    async function fileUploads(event) {
        for(const [key, file] of Object.entries(event.target.files)) {
            fnFilePromises(file);
        }

        files = [...await Promise.all(filePromises)];
        isFilesReady = true;
    }

    function render2() {
        toggleMenu();
        document.querySelector('textarea').value.split(',').forEach((item) => {
            arrangeInputData(item, item);
        });

        fn2();
    }

    function fnFilePromises(file) {
        filePromises.push(
            new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async (readerEvent) => {
                    preview(readerEvent.target.result);
                    resolve({fileData: file, src: readerEvent.target.result});
                };
                reader.onerror = (error) => {
                    reject(error);
                };
            })
        );
    }

    function preview(src) {
        const imgPreview = document.createElement('img');
        imgPreview.src = src;
        imgPreview.className = 'previewImage';

        document.querySelector("#preview-image-container").appendChild(imgPreview);
    }

    function arrangeInputData(uploadedFileData, fileSource) {
        let regex = /(\d{4})-(\d{2})-(\d{2})/gm;
        let fileName = uploadedFileData.name || fileSource;
        let m = regex.exec(fileName);
        // console.log(m);

        if(m !== null) {
            if (Object.keys(arrangedData).includes(m[2])) {
                if (Object.keys(arrangedData[m[2]]).includes(m[3])) {
                    if (Object.keys(arrangedData[m[2]][m[3]]).includes(m[1])) {
                        arrangedData[m[2]][m[3]][m[1]].push(fileSource);
                    } else {
                        arrangedData[m[2]][m[3]][m[1]] = [];
                        arrangedData[m[2]][m[3]][m[1]].push(fileSource);
                    }
                } else {
                    arrangedData[m[2]][m[3]] = {};
                    arrangedData[m[2]][m[3]][m[1]] = [];
                    arrangedData[m[2]][m[3]][m[1]].push(fileSource);
                }
            } else {
                arrangedData[m[2]] = {};
                arrangedData[m[2]][m[3]] = {};
                arrangedData[m[2]][m[3]][m[1]] = [];
                arrangedData[m[2]][m[3]][m[1]].push(fileSource);
            }
        }

        //console.log(arrangedData);
    }

    function render() {
        if(isFilesReady) {
            toggleMenu();
            files.forEach((item) => {
                arrangeInputData(item.fileData, item.src);
            });

            fn2();
        }
    }

    function fn(src) {
        let imgElement = document.createElement('img');
        imgElement.setAttribute('src', src);
        imgElement.setAttribute('width', '100');
        imgElement.setAttribute('height', '100');
        return imgElement;
    }

    function addCalendarShiftDay(numberOfFirstDayInMonth) {
        for(let j = 1; j <= numberOfFirstDayInMonth; j++) {
            let divElement = document.createElement('div');
            divElement.classList.add('m-space');

            document.querySelector('#calendar').appendChild(divElement);
        }
    }

    function fn2() {
        const monthNames = ["January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        const currentYear = new Date().getFullYear();
        const userPickMonth = document.querySelector('#calendar-month').value;
        const currentMonth = userPickMonth ? userPickMonth - 1 : Object.keys(arrangedData)[0] - 1;
        console.log(currentMonth);

        // title
        const heading = document.createElement('h1');
        heading.innerText = `${monthNames[currentMonth]} ${currentYear}`;
        document.querySelector('#title').appendChild(heading);

        const currentDate = new Date(+currentYear, +currentMonth + 1, 0);
        console.log(currentDate);
        const daysInCurrentMonth = currentDate.getDate();
        console.log(daysInCurrentMonth);
        const numberOfFirstDayInMonth = new Date(+currentYear, +currentMonth, 1).getDay();
        console.log(numberOfFirstDayInMonth);
        const numberOfLastDayInMonth = new Date(+currentYear, +currentMonth, daysInCurrentMonth).getDay();
        console.log(numberOfLastDayInMonth);

        addCalendarShiftDay(numberOfFirstDayInMonth - 1);

        for(let dayInMonth = 1; dayInMonth <= daysInCurrentMonth; dayInMonth++) {
            const currentMonthLeadZero = currentMonth + 1 < 10 ? `0${currentMonth + 1}` : (currentMonth + 1).toString();
            let dayInMonthLeadZero = dayInMonth < 10 ? `0${dayInMonth}` : dayInMonth.toString();
            if (Object.keys(arrangedData[currentMonthLeadZero]).includes(dayInMonthLeadZero)) {
                let divElement = document.createElement('div');
                divElement.classList.add('month-cell');

                let photoDay = document.createElement('span');
                photoDay.classList.add('m-day');
                photoDay.innerText = `${dayInMonth}`;

                divElement.appendChild(photoDay);

                let container = document.createElement('div');
                container.style.overflowY = 'scroll';
                container.style.width = '100%';
                container.style.height = '200px';

                let totalPhotoPerDay = 0;

                // all years in this month+day
                Object.entries(arrangedData[currentMonthLeadZero][dayInMonthLeadZero]).forEach((item) => {
                    arrangedData[currentMonthLeadZero][dayInMonthLeadZero][item[0]].forEach((photoSrc) => {
                        let wrapper = document.createElement('div');
                        wrapper.style.position = 'relative';

                        let photoYear = document.createElement('span');
                        photoYear.classList.add('m-year');
                        photoYear.innerText = item[0];

                        wrapper.appendChild(fn(photoSrc));
                        wrapper.appendChild(photoYear);
                        totalPhotoPerDay+=1;

                        container.appendChild(wrapper);
                    });
                });

                if(totalPhotoPerDay > 1) {
                    // badge of all photos related to this day in this month
                    let amountPhotos = document.createElement('div');
                    amountPhotos.classList.add('amount-photos');
                    amountPhotos.innerHTML = totalPhotoPerDay.toString();

                    divElement.appendChild(amountPhotos);
                }

                divElement.appendChild(container);

                document.querySelector('#calendar').appendChild(divElement);
            } else {
                let divElement = document.createElement('div');
                divElement.classList.add('m-no-photo-space');

                let photoDay = document.createElement('span');
                photoDay.classList.add('m-day');
                photoDay.innerText = `${dayInMonth}`;

                divElement.appendChild(photoDay);

                document.querySelector('#calendar').appendChild(divElement);
            }
        }

        addCalendarShiftDay(7 - numberOfLastDayInMonth);
    }

    function toggleMenu() {
        document.querySelector('.menu').classList.toggle('open');
    }

    function toggleSources() {
        document.querySelector('.loaded-sources').classList.toggle('hide');
        document.querySelector('.linked-sources').classList.toggle('hide');
    }
</script>
</body>
</html>